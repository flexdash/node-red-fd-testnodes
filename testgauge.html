<!-- FlexDash TestGauge node for Node-RED
     Copyright (c) 2022 by Thorsten von Eicken, see LICENSE -->

<script type="text/javascript">
  RED.nodes.registerType('flexdash testgauge', {
    // properties of the NR node used by NR itself
    category: 'flexdash',
    color: "#FDF0C2",
    inputs: 1,
    outputs: 0,
    icon: "font-awesome/fa-dashboard", // icon in flow editor
    paletteLabel: "FD testgauge",

    // node config properties that the user can edit in the flow editor
    defaults: {
      // required fields for FlexDash Widget nodes
      fd: { type:"flexdash config", value:"", required:true }, // FlexDash config node
      name: { value: '' }, // name field of NR node (standard)

      // widget fields, i.e. values being transmitted to the FlexDash Widget
      unit: { value: "" },
      title: { value: 'Gauge' },
      color: { value: "#00ee00" },
      arc: { value: 90 },
      min: { value: 0 },
      max: { value: 100 },
    },

    // NR node label
    label() { return this.name || "flexdash testgauge" },
    labelStyle() { return this.name ? "node_label_italic" : "" },

    oneditprepare() {
      $('#fd-tab-props').load("resources/@flexdash/node-red-fd-testnodes/testgauge-props.html", () => {
        $('.fd-typed-input').each((ix, el) => {
          el = $(el)
          const it = el.attr('input-type')
          if (it && it !== 'any') {
            el.typedInput({type:it, types:[it], typeField: el.id + '-type'})
          } else {
            el.typedInput({typeField: el.id + '-type'})
          }
        })
      })

      // for (const k of ['arc', 'min', 'max']) {
      //   $("#node-input-"+k).typedInput({type:"num", types:["num"], typeField:`node-input-${k}-type`})
      // }

      var tabs = RED.tabs.create({ id: "fd-tabs", onchange(tab) {
          $("#fd-tabs-content").children().hide()
          $("#" + tab.id).show()
      }})
      tabs.addTab({ id: "fd-tab-node", label: "Node config" })
      tabs.addTab({ id: "fd-tab-props", label: "Widget props" })
      if (!this.name || !this.fd) tabs.activateTab("fd-tab-node")
      else tabs.activateTab("fd-tab-params")
    },
  })
</script>

<script type="text/html" data-template-name="flexdash testgauge">
  <!-- Icons: https://fontawesome.com/v4/icons/ -->
  <!-- row of tabs at the top -->
  <div class="form-row fd-tabs-row">
    <ul style="min-width: 600px; margin-bottom: 20px;" id="fd-tabs"></ul>
  </div>

  <div id="fd-tabs-content" style="min-height: calc(100% - 95px);">

    <!-- tab for the node properties -->
    <div id="fd-tab-node" style="display:none">
      <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
      </div>
      <div class="form-row">
        <label for="node-input-fd"><i class="fa fa-th"></i> Dashboard</label>
        <input type="text" id="node-input-fd">
      </div>
    </div>

    <!-- tab for the widget params -->
    <div id="fd-tab-props" style="display:none"></div>
  </div>
</script>

<script type="text/html" data-help-name="flexdash testgauge" id="test-gauge-help">
  <p>A Node-RED dashboard FlexDash node to display a gauge on the dashboard.</p>
  <p>This is test for integrating FlexDash nodes into Node-Red.</p>
</script>
